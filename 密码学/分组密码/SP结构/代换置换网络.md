代换-置换网络 (SPN), 使用多次**迭代** (非幂等算法) 和**乘积**提高安全性. 和Feistel结构相比, SP网络扩散更快, 但加解密结构区别较大.

**单轮流程**:
![|300](../../../attach/Pasted%20image%2020230607124629.png)

**多轮流程**:

加密:  
`AddK` - \[ $S$-$P$-`AddK` \] - \[ $S$-$P$-`AddK` \] - \[ $S$-$P$-`AddK` \]

解密:  
\[ `Addk`-$P^{-1}$-$S^{-1}$ \] - \[ `Addk`-$P^{-1}$-$S^{-1}$ \] - \[ `Addk`-$P^{-1}$-$S^{-1}$ \] - `Addk`

等效解密:  
`Addk`-$P^{-1}$ - \[ $S^{-1}$-$P^{-1}$-`AddPk` \] - \[ $S^{-1}$-$P^{-1}$-`AddPk` \] - $S^{-1}$-`Addk`

==等效解密可复用加密的部分结构.== 可以舍去最后一轮的 $S$代换, 让加密结构与等效解密结构更加类似.

证明: $P$是纯置换顺序操作. 由于 $P$ 是[线性变换](../../../代数/线性代数/线性变换.md), 所以 $P^{-1}$也是线性变换,  所以 $f=P^{-1}\ (K\oplus X)=P^{-1}(K)\oplus P^{-1}(X)$. 其中, $\oplus$ (`Addk`) 理解为 $GF(2^{n})$ [伽罗华域](../../../代数/抽象代数/伽罗华域.md)上的加法, 满足线性变换加法性质.

### 幂等密码体制

幂等密码 $S$, 有 $S^{2}=S$, 即自己嵌套自己不能增加安全性.

如: 移位, 代换, 乘法, 仿射, 置换, 维吉尼亚, 希尔密码都是幂等的. 

通常用两不同幂等密码的乘积 $S_{1}\times S_{2}$ 来构造 *非幂等密码*, 但需保证两者不可交换.