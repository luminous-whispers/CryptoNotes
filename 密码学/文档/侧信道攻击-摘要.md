> [Introduction to Side-Channel Attack](Introduction%20to%20Side-Channel%20Attacks.pdf) 综述文献阅读报告.

## 文章研究要点

过往密码研究中, 敌手往往围绕明密文和加解密能力对密码系统实施攻击; 但在具体实践过程中, 密码系统的输入输出不仅仅是明密文和密钥了, 还有更多隐藏信息, 比如: 加解密时序信息, 能量消耗, 电磁泄漏, 各种故障和错误等. 这些额外的信息, 被称为"侧信道信息", 也可能导致密钥或敏感信息的泄露, 对安全系统造成威胁. 

针对侧信道信息的攻击, 被称为**侧信道攻击, Side Channel Attack**. 由于其攻击手段的多变性与紧密结合密码实践的高效性, 侧信道攻击已经成为密码系统的不可忽视的威胁. 本文: ***Intrduction to Side-Channel Attack***, 是由 Hagai Bar-EI 写作的一篇综述性论文, 分两部分, 第一部分介绍侧信道攻击的常见类型, 包括时序攻击, 能耗分析攻击和故障攻击; 第二部分则从常见侧信道攻击类型出发, 介绍防御侧信道攻击的丰富手段.

## 侧信道攻击的方式

### 1 时序攻击

**Timing Attacks, 时序攻击**通过测量目标系统某一加密单元的执行时间或响应时间, 来推测出密钥或敏感信息. 密码系统不同处理过程需要不同的执行时间, 引用[2]论证了通过时序攻击, 可以恢复出脆弱密码系统的**完整**密钥.

时序攻击需借助时序统计分析模型. 通过测量多个样本的时序差异, 可以以一定概率猜测出某些比特位的值. 通过增加样本, 最终恢复出完整密钥. 使用样本数量取决于样本噪声大小. **时序攻击中, 敌手通常仅需要已知明文攻击能力**

本文主要依托于引用[2], 介绍公钥密码的一些时序攻击, 但该方案也适用于其他密码系统.

#### 1.1 针对模指数的简单分析

DH和RSA中都需要计算 $Y=\alpha^{X}\pmod{n}$, 敌手窃听知 $\alpha$, 那么就知道单次计算 $\alpha^{2}$ 的时间, 那么通过测量密码系统中计算了多少次 $\alpha^{2}$ , 就可以恢复出密钥 $X$. 尤其, 当密码系统采用了交互式协议 (单次调用), 测量 $\alpha^{2}$ 的计算次数就会更加容易.

#### 1.2 针对蒙哥马利模乘和中国剩余定理的时序分析

应用模指数运算的密码系统中, 通常会采取两种方式优化模指数运算速度: 一是加速指数运算, 比如用窗口法和快速模幂算法; 二是优化基础的模乘运算和模逆运算, 通过坐标系转换可以减少模逆运算, 优化模乘运算的核心则是减少模约减运算, 如使用蒙哥马利模乘. 

模约减, 即 $a \pmod{n}=a-n\cdot\lfloor \frac{a}{n}\rfloor$, 是造成模乘运算时间差异的主要因素. ==时序攻击正是通过分析这种可探测时间差异来获取敏感信息的.== **[蒙哥马利模乘](https://en.wikipedia.org/wiki/Montgomery_modular_multiplication), Montgomery Multiplication**, 通过将乘数变换到蒙哥马利形式来规避模约减运算, 能够有效减少模乘运算时序特征, 从而增强对时序攻击的抗性. 

在某些RSA系统中, 会通过**中国剩余定理, CRT, Chinese Remainder Theorem,** [加速解密运算](../公钥密码/RSA/RSA.md). 该方法要利用 $p,q$, 而敌手一旦知晓 $p,q$, 就易求出私钥 $d$. 该方法面对时序攻击时是脆弱的, 敌手可选择明文消息 $msg$, 则密码系统将计算 $msg\pmod{p}$ 和 $msg\pmod{q}$, $msg>p$ 和 $msg<p$ 会存在一个模约减运算时间差, 二分法不断修改 $msg$, 可求出 $p,q$. 引用[2]对该方案进行了更深入研究.


#### 1.3 针对DSS的时序攻击

DSS, Digital Signature Standard 是由 NIST 颁发的一种带附录的数字签名标准, 其核心是[DSA, Digital Signature Algorithm](../公钥密码/数字签名.md). 签名算法为 $s=k^{-1}(Hash(M)+x\cdot r)\pmod{q}$, 其中 $r=g^{k}\pmod{p}\pmod{q}$, $k$ 为随机数.

要分析DSA签名的时序特点, 重点也在于分析前文所提的**模约减运算**导致的时序差异. 其中明文 $M$ 公开, 所以 $Hash(M)$ 的计算开销已知, 同时由于 $Hash(M)$ 和 $q$ 的数量级类似, 所以对模约减运算只有很小影响. 因此, 签名算法主要的模约减运算开销来源于计算 $(x\cdot r)\pmod{q}$. 引用[2]介绍了一种分析 $x$ 的时序攻击方式: $x\cdot r\pmod{q}$ 影响模约减运算, 其中影响最大的应是 $x$ 的最高比特位, 也就是说 $x$ 最高比特位和整体模约减时间开销最相关, 因此可从高到低逐位分析出 $x$ 的每一比特位.

### 2 功耗分析攻击

功耗分析攻击, Power Anlysis Attacks 指敌手通过分析密码系统某单元实现电路的功耗与电磁辐射情况, 来发掘敏感信息的攻击手段. 常见功耗分析攻击分为**简单功耗分析攻击 SPA 和差分功耗分析攻击 DPA**. 测量功耗常见手段是串联一个电流表 (小已知电阻).

#### 2.1 简单功耗分析攻击 SPA

简单功耗分析, 指对密码系统的某一单元的能耗进行统计分析, 可识别出密码系统不同的功能模块 (比如区分模幂和模乘运算), 也可识别出硬件指令序列. 简单能耗攻击对依赖数据决定程序执行路径的密码系统威胁较大, 比如: 比较, 模指数和模约减, DES置换, DES密钥调度.

#### 2.2 差分功耗分析 DPA

与SPA分析密码系统模块不同, DPA分析的是输入数据差异导致的功耗差异. 输入数据的微小差异, 将直接导致过程中相关模块的能耗状态差异. DPA甚至无须太多密码系统的详细实现信息, 就可以通过差分方法找出密钥. 具体攻击方案见引用[5]. 

DPA对对称密码攻击效果好于公钥密码, 因为公钥密码运算单元的计算复杂度更大, 泄露的信号量信息密度大, 难以分析.

### 3 故障攻击

Fault Attacks, 故障攻击 指敌手通过一系列手段使实际密码系统出现错误, 并通过错误来找到密钥或敏感信息. 制造错误的手段包括改变电压, 修改系统时钟, 施加电磁辐射或寻找其自然产生的错误漏洞. 

故障攻击分为**差分故障分析攻击, Differential Fault Analysis Attacks, DFA** 和 **非差分故障攻击**. 其中非差分故障攻击的特点是不需要正确的密文信息, 而差分故障攻击特点是需要对比错误发生前后两次加密的结果, 无需明文信息而能恢复出密钥.

例如针对DES的差分故障攻击, 引用[3]演示了一种方式, 通过多组1比特的结果差异, 分析出末轮48比特轮密钥, 从而恢复出56位密钥或直接破译最后一轮DES. DFA通常和其他类型差分攻击一起使用.

## 预防侧信道攻击的方式

### 1 一般性方案

#### 1.1 Data-Independent Calculations

所有操作的运算时间不应该和输入的明文数据与密钥数据有关. 即不管明文和密钥具体值是多少, 所有子操作进行运算时, 执行指令的时钟时间应该相同. 设想极端情况, 每个子系统执行时间均相同, 那么也就不存在可供分析的时序特点.

#### 1.2 盲化

Blinding, 盲化签名技术, 可以让用户在不透露具体信息的情况下得到其签名. 通过对输入进行盲化, 可以隐藏如RSA签名中模指数运算的电磁辐射信息, 能耗信息等. 但盲化因子本身的选取需要满足随机性, 并且盲化过程本身也是抗侧信道攻击的.

#### 1.3 避免条件分支

应避免根据某些敏感中间信息进行加密系统运行中的条件分支, 这是1.1方案的演进方案. 当不管输入是多少时, 一个系统总执行相同的所有的代码 (由最基础的AND, OR, XOR组成), 敌手很难收集到能够泄露敏感信息的时序与能耗侧信道信息. 该方案可以抵御大部分时序攻击与能耗攻击.

### 2 抵抗时序攻击方案

#### 2.1 延迟

1.1中方案是启发式的, 但实际系统中, 子系统执行时间全部与最差执行时间对齐, 会导致系统不可用. 为了掩盖侧信道时序信息, 可以向子系统添加**随机延迟**, 相当于时序噪音 (timing noise). 根据引用[2], 时序攻击需要的样本量增长速度, 大概是时序噪音增长速度的平方. 该方案可以让时序攻击更困难, 但其仍可以行.

#### 2.2 让相乘与平方等时

虽然让各子系统等时实际不可行, 但可以让基础运算等时, 比如让平方操作 $a^{2}$ 和相乘操作 $a\cdot b$ 执行时间相同. 该方法让敌手通过时序攻击, 无法分析出 "if, when and how" 两种运算在算法内部被如何执行. 该方案主要保护对象是公钥密码的模幂运算, 该运算是大多时序攻击的攻击重点.

需注意, 这一性质并不是显然的, 比如在[ECC](../公钥密码/ECC/ECC.md)中, 加法和倍点运算看着类似, 实质计算方法就完全不同, 很容易被时序分析分别识别出来.

### 3 抵抗能耗分析攻击方案

抵抗能耗攻击的整体思路和抵抗时序攻击类似, 就是通过修改协议方案, 添加冗余精简暴露, 来隐藏和遮掩能耗痕迹. 常见方法包括**能耗平衡, 减少电路信号量, 添加噪声**等方法. 具体方案请见引用[4]和[5]. 添加冗余的方式不能根除受能耗分析攻击的风险, 只能使敌手要攻破系统所收集的样本变得更难更多.

### 4 抵抗故障攻击方案

防御DFA的一种方式是, 加密同一明文两次, 检查结果是否一致, 一致才作为结果输出. 该方法有两个缺点, 一是增大了加密时间消耗, 二是两次加密出现同样故障的几率不是没有, 不能绝对防御.
	
## 总结与展望

侧信道攻击核心思想是通过分析侧信道信息, 来获取密码系统内部的中间状态 (包括数据状态与运行状态), 从而获取敏感信息, 甚至破译密钥. 主要的手段有两种, 一是借助侧信道信息进行差分分析, 二是分析系统实现机制, 预测内部模块功能. 

侧信道攻击通常不易被察觉, 但较易被预防. 最主要的预防手段是向密码系统的具体实现中添加噪声, 以一定效率牺牲为代价, 隐藏过程敏感信息. 但这种方法只能增大敌手分析样本难度, 但无法彻底根治侧信道安全隐患. 最根本的解决方案还是要从密码系统协议出发, 设计时就充分考虑到侧信道的各种攻击手段和能力.

侧信道攻击已成为密码学攻击中一个重要攻击手段. 现代密码学在往实现更丰富的功能上发展, 随着系统复杂度提高, 隐蔽的侧信道攻击需要引起我们愈高的重视.

<br>

## 引用

1. Introduction to Differential Power Analysis and Related Attacks / Paul C. Kocher, Joshua Jaffe, and Benjamin Jun
2. Timing Attacks on Implementatjons DH, RSA, DSS and Other Systems / Paul C. Kocher
3. Differential Fault Analysis of Secret Key Cryptosystems / Eli Biham & Adi Shamir
4. Differential Power Analysis / Paul Kocher, Joshua Jaffe, and Benjamin Jun
5. Investigations of Power Analysis Attacks on Smartcards / Thomas S. Messerg s, Ezzy A. Dabbish, and Robert H. Sloan
6. Tamper Resistance - a Cautionary Note / Ross Anderson & Markus Kuhn Informative Reference
7. Side Channel Cryptanalysis of Product Ciphers / John Kelsey, Bruce Schneier, David Wagner, and Chris Hall