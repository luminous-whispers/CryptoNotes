## 1 RSA加密

加密用于保密，**防止信息泄露**
![[Pasted image 20230420135629.png|600]]

## 2 RSA签名

签名用于认证，**防止信息被篡改**
![[Pasted image 20230420140708.png|600]]
**总结：公钥加密、私钥解密、私钥签名、公钥验签。**

注意：因为rsa在加解密的时候，有长度限制，应该采用分段式加解密，还需要适当填充保证安全。

### 实际实现方式
明密文长度太长, 增加传输成本和验证成本. 通常采用取哈希值的方法.
除此之外, 采用哈希值, 长度易控制, 并且有很好的抗碰撞性.

签名流程:
1. 计算原始明文的哈希值H
2. 用私钥对哈希值H进行加密, 生成数字签名
3. 发送者将数字签名附加到原始明文上, 发送


## 3 先签名再加密
为了同时实现保密性和认证性，需要同时采用双重加解密：

$$A\longrightarrow E_{SK_{A}} \longrightarrow E_{PK_{B}}\longrightarrow D_{SK_{B}}\longrightarrow D_{PK_{A}} \longrightarrow B$$

其中$PK_{B}$用于保密, $PK_{A}$用于认证.

### 顺序合理性
先签名再加密, 只有接收者可以验证.
先加密再签名, 可以公开验证.

推荐使用先签名再加密, 主要有以下优点:
- 防止中间人攻击, 同时防止接收方抵赖
- 保护签名者身份

### 针对"先加密再签名"的攻击方式
#### 中间人攻击

- Alice 发送: 加密消息C + 对C签名$S_{A}$
- Miledy 截获A信息, 替换为用自身私钥的签名, 转发给B: 加密消息C + 签名$S_{M}$
- Bob 收到 C + $S_M$, 在证书中匹配可以验签的公钥, 因此误认为消息来源是Miledy

#### RSA签名攻击
**如果使用先加密再签名**, 对于RSA签名, 存在一种攻击方法: 
这种攻击的危险性在于, m可能是某种授权信息, 一旦获得Alice签名, 就不能抵赖. 而伪造的$m_{1}$却仅仅是随机数而已. 

Suppose you want to obtain the signature $s = m^d \bmod n$ on a chosen message $m$. Here is that attack.

1.  You ask the signer to sign a random message $m_1$ and obtain the corresponding signature $s_1 = m_1^d \bmod n$;
2.  You compute message $m_2 := m\cdot m_1^{-1} \bmod n$ and ask the signer to sign message $m_2$; you obtain the signature $s_2 = m_2^d \bmod n$.

From the pairs $(m_1,s_1)$ and $(m_2,s_2)$, the signature $s$ on chosen message $m$ can be recovered as $s = s_1 \cdot s_2 \bmod n$.

To see it, observe that $s \equiv s_1 \cdot s_2 \equiv m_1^d \cdot m_2^d \equiv m_1^d \cdot (m\cdot m_1^{-1})^d \equiv m_1^d \cdot m^d \cdot m_1^{-d} \equiv m^d \pmod n$.

___

Note that you could obtain the signature on message $m$ by only asking **one** signature to the signer. Indeed, you can construct the pair $(m_1,s_1)$ in Step 1 above by yourself as follows: choose a random $s_1$ modulo $n$ and define $m_1 = s_1^e \bmod n$ (where $e$ is the public verification exponent). We then have $m_1^d \equiv s_1 \pmod n$ as required.

> 来源：[RSA签名攻击](https://crypto.stackexchange.com/questions/35644/chosen-message-attack-rsa-signature/35656#35656) 当然，如果签名加入了哈希函数，该方法会失效。