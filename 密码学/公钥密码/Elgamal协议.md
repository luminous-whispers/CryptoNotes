基于离散对数困难问题, 可以用于加密和签名. #重点

# Elgamal 加密

由于使用了随机数, 所以又称随机化加密. 使同一明文使用同一公钥加密产生的密文不同, 有效防御选择明文攻击和重放攻击等.

ElGamal体制效率没有RSA高, 并且消息长度有两倍扩展.

## 1 密钥生成

1. 选取大素数q, 使求解离散对数问题在 $\mathbb{Z}_{q}$上困难
2. 选取 $\mathbb{Z}_{q}^*$ 上的本原元 $\alpha$
3. 选随机整数 $X_{A}\in \left[1, q-2\right]$, 计算 $Y_{A}=\alpha^{X_{A}}\pmod q$

则 Alice 的**公钥**为 $\{q, \alpha, Y_{A}\}$, **私钥**为 $\{X_A\}$

## 2 加密
Bob 向 Alice发送消息 $M\in\left[1, q-1\right]$ :

1. 选取**一次性**随机数 $k\in \mathbb{Z_{q-1}}$
2. 计算一次性密钥 $K=(Y_{A})^{k}\pmod q$
3. $C_{1}=a^{k}\pmod q$
4. $C_{2}=KM\pmod q$

Bob 向 Alice 发送密文对 $\left(C_{1}, C_{2}\right)$

> 注意, 同一次加密中, 对于每组加密不能使用相同随机数k.  
> 否则其他组明文泄露后, 会使所有使用同一k的密文皆不安全.

## 3 解密

Alice 恢复 $M=C_{2}(C_{1}^{X_{A}})^{-1}\pmod q$

**证明**:

$K\equiv(Y_{A})^{k}\pmod q\equiv (a^{X_{A}})^k\pmod q$

使用 $C_1$ 恢复出 $K$:  
$C_{1}^{X_{A}}=(a^{k})^{X_{A}}\pmod q$

使用 $K$和 $C_{2}$恢复出 $M$:  
$C_{2}\equiv KM\pmod q\equiv (a^{X_{A}})^{k}M\pmod q$

## 4 安全性分析

公开信道上有: $C_{1}$, $C_{2}$, $\{q, \alpha, Y_{A}\}$  
安全性由如下困难性保证:  

1. 知道 $C_{1}=\alpha^{k}$ 和 $\alpha$, 无法解出 $k$
2. 知道 $Y_{A}=\alpha^{X_{A}}$ 和 $\alpha$, 无法解出 $X_{A}$

$k$和$X_{A}$任一泄露, 明文都会泄露. 所以两者都是密钥.  
不加随机值$k$的DH体制无法实现加密功能, 因为只需求$Y_{A}^{-1}$即可解出$M$

另外, ElGamal体制的随机数**k也不能重复使用**.

***
# 问题
***离散对数问题的陷门信息是什么？？*** 因为没有所以才导致了构造密码体制这么别扭吧，必须两者同时参与

***

# Elgamal 签名

## 1 密钥生成

1. 选取大素数q, 使求解离散对数问题在 $\mathbb{Z}_{q}$上困难
2. 选取 $\mathbb{Z}_{q}^*$ 上的本原元 $\alpha$
3. 选随机整数 $X\in \left[1, q-2\right]$, 计算 $Y=\alpha^{X}\pmod q$

则 Alice 的**公钥**为 $\{q, \alpha, Y\}$, **私钥**为 $\{X\}$

## 2 签名

1. $m=Hash(M)$, M为待签字消息
2. 选择随机数 $k$, $S_{1}=\alpha^{k}\pmod p$
3. $S_{2}=k^{-1}(m-XS_{1})\pmod {p-1}$, 注意选取 $(k,\ p-1)=1$

最终签名为 $Sig(X, M)=\{S_{1},\ S_{2}\}$

## 3 验证

1. $m=Hash(M)$, M为原始消息
1. $V_{1}=\alpha^{m}\pmod p$
2. $V_{2}=Y^{S_{1}}S_{1}^{S_{2}}\pmod p$
3. 验证 $V_{1}\equiv V_{2}$

**证明**

因为 $XS_{1}+kS_{2}=XS_{1}+kk^{-1}(m-XS_{1})=m \pmod{\phi(p)}$,  
所以$V_{2}=Y^{S_{1}}S_{1}^{S_{2}}=g^{XS_{1}+kS_{2}}\pmod p=g^{m}\pmod p\equiv V_{1}$


## 4 安全性分析

#### 构造思路

使用对外隐藏的临时密钥r, 将*私钥d对哈希值的签名 $hash(M)+d$* 加密, 同时公开临时公钥$[r]G$.  
这样敌手即不能从签名推断出私钥d(不知r), 也不能伪造签名(不知d).

**为什么使用 $XS_{1}$ 而不是 $X$?**

#### 攻击

攻击者伪造签名, 等价于破解私钥 $X$, 归约于离散对数困难问题.

$k$不能泄露, 且不能重复使用. 如果重复使用, 私钥 $x$将由下列方程算出:
$$\begin{align}
H(m_{1})=XS_{1}+kS_{1}\\
H(m_{2})=XS_{2}+kS_{2}
\end{align}$$

<br>

> ElGamal签名存在较多变形, 见[数字签名算法汇总](数字签名.md), 如 Schenorr和 DSA.

> ElGamal协议也被构建于椭圆曲线有限域上, 见[ECC-Elgamal](ECC/ECC-Elgamal公钥加密.md)